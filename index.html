<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ–°å‘˜å·¥å…¥èŒæ™ºèƒ½åŠ©æ‰‹ - åŸºäºRAGFlow</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.95;
        }

        .header .tech-badge {
            display: inline-block;
            background: rgba(255,255,255,0.2);
            padding: 6px 16px;
            border-radius: 20px;
            margin-top: 10px;
            font-size: 0.9em;
        }

        .main-layout {
            display: grid;
            grid-template-columns: 350px 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        @media (max-width: 1024px) {
            .main-layout {
                grid-template-columns: 1fr;
            }
        }

        .card {
            background: white;
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }

        .card h2 {
            font-size: 1.5em;
            margin-bottom: 20px;
            color: #333;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .sidebar {
            height: fit-content;
        }

        .config-section {
            margin-bottom: 24px;
            padding-bottom: 24px;
            border-bottom: 1px solid #eee;
        }

        .config-section:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }

        .config-section h3 {
            font-size: 1.1em;
            margin-bottom: 12px;
            color: #667eea;
        }

        .input-group {
            margin-bottom: 16px;
        }

        .input-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 600;
            color: #555;
            font-size: 0.9em;
        }

        .input-group input,
        .input-group select {
            width: 100%;
            padding: 10px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 0.95em;
            transition: border-color 0.3s;
        }

        .input-group input:focus,
        .input-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 10px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #f3f4f6;
            color: #333;
        }

        .btn-secondary:hover {
            background: #e5e7eb;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px;
            background: #f9fafb;
            border-radius: 8px;
            font-size: 0.9em;
        }

        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #6c757d;
        }

        .status-dot.connected {
            background: #28a745;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .file-upload-area {
            border: 2px dashed #d1d5db;
            border-radius: 12px;
            padding: 32px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 16px;
        }

        .file-upload-area:hover {
            border-color: #667eea;
            background: #f9fafb;
        }

        .file-upload-area.dragging {
            border-color: #667eea;
            background: #eff6ff;
        }

        .file-list {
            max-height: 200px;
            overflow-y: auto;
        }

        .file-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px;
            background: #f9fafb;
            border-radius: 8px;
            margin-bottom: 8px;
        }

        .file-item-name {
            flex: 1;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            margin-right: 12px;
        }

        .file-item-size {
            font-size: 0.85em;
            color: #6c757d;
            margin-right: 12px;
        }

        .remove-file-btn {
            color: #dc3545;
            cursor: pointer;
            padding: 4px 8px;
        }

        .chat-container {
            display: flex;
            flex-direction: column;
            height: 600px;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            background: #f9fafb;
            border-radius: 12px;
            margin-bottom: 16px;
        }

        .message {
            margin-bottom: 20px;
            display: flex;
            gap: 12px;
        }

        .message.user {
            flex-direction: row-reverse;
        }

        .message-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            font-size: 1.2em;
        }

        .message.user .message-avatar {
            background: #667eea;
            color: white;
        }

        .message.assistant .message-avatar {
            background: #e5e7eb;
        }

        .message-content {
            max-width: 70%;
            padding: 14px 18px;
            border-radius: 12px;
            line-height: 1.6;
        }

        .message.user .message-content {
            background: #667eea;
            color: white;
        }

        .message.assistant .message-content {
            background: white;
            color: #333;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .message-sources {
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid #e5e7eb;
        }

        .message-sources h4 {
            font-size: 0.85em;
            color: #667eea;
            margin-bottom: 8px;
        }

        .source-item {
            font-size: 0.85em;
            padding: 6px 10px;
            background: #f3f4f6;
            border-radius: 6px;
            margin-bottom: 6px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .source-item:hover {
            background: #e5e7eb;
        }

        .chat-input-area {
            display: flex;
            gap: 12px;
        }

        .chat-input {
            flex: 1;
            padding: 12px 16px;
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            font-size: 1em;
            resize: none;
            font-family: inherit;
            min-height: 48px;
            max-height: 120px;
        }

        .chat-input:focus {
            outline: none;
            border-color: #667eea;
        }

        .send-btn {
            padding: 12px 24px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .send-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
        }

        .quick-questions {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin-bottom: 16px;
        }

        .quick-question-btn {
            padding: 8px 16px;
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.3s;
        }

        .quick-question-btn:hover {
            border-color: #667eea;
            background: #eff6ff;
            color: #667eea;
        }

        .loading {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 3px solid rgba(102, 126, 234, 0.3);
            border-radius: 50%;
            border-top-color: #667eea;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .alert {
            padding: 12px 16px;
            border-radius: 8px;
            margin-bottom: 16px;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border-left: 4px solid #28a745;
        }

        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border-left: 4px solid #dc3545;
        }

        .alert-info {
            background: #d1ecf1;
            color: #0c5460;
            border-left: 4px solid #17a2b8;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #6c757d;
        }

        .empty-state-icon {
            font-size: 3em;
            margin-bottom: 16px;
            opacity: 0.5;
        }

        .feature-list {
            list-style: none;
            padding: 0;
        }

        .feature-list li {
            padding: 8px 0;
            padding-left: 24px;
            position: relative;
            font-size: 0.9em;
        }

        .feature-list li::before {
            content: 'âœ“';
            position: absolute;
            left: 0;
            color: #28a745;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“ æ–°å‘˜å·¥å…¥èŒæ™ºèƒ½åŠ©æ‰‹</h1>
            <p>åŸºäºRAGFlowçš„ä¼ä¸šçŸ¥è¯†åº“é—®ç­”ç³»ç»Ÿ</p>
            <div class="tech-badge">Powered by RAGFlow + OpenAI</div>
        </div>

        <div class="main-layout">
            <!-- å·¦ä¾§è¾¹æ ï¼šé…ç½®å’Œæ–‡æ¡£ç®¡ç† -->
            <div class="sidebar">
                <div class="card">
                    <h2>âš™ï¸ é…ç½®</h2>

                    <div class="config-section">
                        <h3>è¿æ¥çŠ¶æ€</h3>
                        <div class="status-indicator" id="statusIndicator">
                            <div class="status-dot" id="statusDot"></div>
                            <span id="statusText">æœªè¿æ¥</span>
                        </div>
                    </div>

                    <div class="config-section">
                        <h3>RAGFlowé…ç½®</h3>
                        <div class="input-group">
                            <label>APIåœ°å€</label>
                            <input
                                type="text"
                                id="apiEndpoint"
                                value="http://localhost:8080"
                                placeholder="http://localhost:8080"
                            >
                        </div>
                        <div class="input-group">
                            <label>API Token</label>
                            <input
                                type="password"
                                id="apiToken"
                                placeholder="ä»RAGFlowåå°è·å–"
                            >
                        </div>
                        <button class="btn btn-primary" onclick="testConnection()">
                            ğŸ”Œ æµ‹è¯•è¿æ¥
                        </button>
                    </div>

                    <div class="config-section">
                        <h3>çŸ¥è¯†åº“ç®¡ç†</h3>
                        <div class="input-group">
                            <label>é€‰æ‹©çŸ¥è¯†åº“</label>
                            <select id="knowledgeBaseSelect">
                                <option value="">-- è¯·å…ˆè¿æ¥RAGFlow --</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="card" style="margin-top: 20px;">
                    <h2>ğŸ“ æ–‡æ¡£ä¸Šä¼ </h2>

                    <div class="file-upload-area" id="fileUploadArea">
                        <div style="font-size: 3em; margin-bottom: 12px;">ğŸ“„</div>
                        <p style="margin-bottom: 8px; font-weight: 600;">ç‚¹å‡»æˆ–æ‹–æ‹½æ–‡ä»¶åˆ°æ­¤å¤„</p>
                        <p style="font-size: 0.85em; color: #6c757d;">
                            æ”¯æŒ PDFã€Wordã€Excelã€PPTç­‰æ ¼å¼
                        </p>
                        <input
                            type="file"
                            id="fileInput"
                            multiple
                            accept=".pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx,.txt,.md"
                            style="display: none;"
                        >
                    </div>

                    <div class="file-list" id="fileList"></div>

                    <button class="btn btn-primary" onclick="uploadFiles()" id="uploadBtn" disabled>
                        â¬†ï¸ ä¸Šä¼ æ–‡æ¡£
                    </button>
                </div>
            </div>

            <!-- å³ä¾§ä¸»åŒºåŸŸï¼šèŠå¤©ç•Œé¢ -->
            <div class="card">
                <h2>ğŸ’¬ æ™ºèƒ½é—®ç­”</h2>

                <div id="alertContainer"></div>

                <div class="quick-questions">
                    <button class="quick-question-btn" onclick="askQuestion('å…¬å¸çš„è€ƒå‹¤åˆ¶åº¦æ˜¯ä»€ä¹ˆï¼Ÿ')">
                        è€ƒå‹¤åˆ¶åº¦
                    </button>
                    <button class="quick-question-btn" onclick="askQuestion('å¦‚ä½•ç”³è¯·å¹´å‡ï¼Ÿ')">
                        å¹´å‡ç”³è¯·
                    </button>
                    <button class="quick-question-btn" onclick="askQuestion('å‘˜å·¥ç¦åˆ©æœ‰å“ªäº›ï¼Ÿ')">
                        å‘˜å·¥ç¦åˆ©
                    </button>
                    <button class="quick-question-btn" onclick="askQuestion('æŠ¥é”€æµç¨‹æ€ä¹ˆèµ°ï¼Ÿ')">
                        æŠ¥é”€æµç¨‹
                    </button>
                </div>

                <div class="chat-container">
                    <div class="chat-messages" id="chatMessages">
                        <div class="empty-state">
                            <div class="empty-state-icon">ğŸ¤–</div>
                            <p style="font-weight: 600; margin-bottom: 12px;">ä½ å¥½ï¼æˆ‘æ˜¯å…¥èŒæ™ºèƒ½åŠ©æ‰‹</p>
                            <p style="font-size: 0.9em; margin-bottom: 16px;">
                                æˆ‘å¯ä»¥å¸®ä½ å¿«é€Ÿæ‰¾åˆ°å…¬å¸åˆ¶åº¦ã€æµç¨‹æ–‡æ¡£å’Œå¸¸è§é—®é¢˜çš„ç­”æ¡ˆ
                            </p>
                            <ul class="feature-list" style="text-align: left; display: inline-block;">
                                <li>ç²¾å‡†æ£€ç´¢ï¼šä»æµ·é‡æ–‡æ¡£ä¸­æ‰¾åˆ°å‡†ç¡®ç­”æ¡ˆ</li>
                                <li>æ¥æºå¯è¿½æº¯ï¼šæ¯ä¸ªç­”æ¡ˆéƒ½æ ‡æ³¨å‡ºå¤„</li>
                                <li>å¤šæ ¼å¼æ”¯æŒï¼šPDFã€Wordã€PPTç­‰éƒ½å¯ä»¥</li>
                                <li>OCRè¯†åˆ«ï¼šæ‰«æä»¶ä¹Ÿèƒ½å‡†ç¡®è¯†åˆ«</li>
                            </ul>
                        </div>
                    </div>

                    <div class="chat-input-area">
                        <textarea
                            class="chat-input"
                            id="chatInput"
                            placeholder="è¾“å…¥ä½ çš„é—®é¢˜...ï¼ˆEnterå‘é€ï¼ŒShift+Enteræ¢è¡Œï¼‰"
                            rows="1"
                        ></textarea>
                        <button class="send-btn" onclick="sendMessage()" id="sendBtn">
                            å‘é€
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div class="card">
            <h2>ğŸ’¡ äº§å“äº®ç‚¹</h2>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
                <div>
                    <h3 style="color: #667eea; margin-bottom: 12px;">ğŸ¯ èšç„¦åœºæ™¯</h3>
                    <ul class="feature-list">
                        <li>è§£å†³æ–°å‘˜å·¥æ‰¾ä¸åˆ°èµ„æ–™çš„ç—›ç‚¹</li>
                        <li>HRå‡å°‘80%é‡å¤é—®é¢˜å›ç­”</li>
                        <li>24/7å®æ—¶å“åº”ï¼Œä¸å—æ—¶é—´é™åˆ¶</li>
                    </ul>
                </div>
                <div>
                    <h3 style="color: #667eea; margin-bottom: 12px;">ğŸš€ æŠ€æœ¯ä¼˜åŠ¿</h3>
                    <ul class="feature-list">
                        <li>åŸºäºRAGFlowæ·±åº¦æ–‡æ¡£ç†è§£</li>
                        <li>OCRè¯†åˆ«æ‰«æä»¶å’Œå›¾ç‰‡</li>
                        <li>åŒè·¯å¬å›+é‡æ’åºï¼Œæ£€ç´¢ç²¾å‡†</li>
                        <li>ç­”æ¡ˆå¯è¿½æº¯ï¼Œæ¶ˆé™¤AIå¹»è§‰</li>
                    </ul>
                </div>
                <div>
                    <h3 style="color: #667eea; margin-bottom: 12px;">ğŸ”— å¯æ‰©å±•æ€§</h3>
                    <ul class="feature-list">
                        <li>å¯é›†æˆé£ä¹¦/é’‰é’‰æœºå™¨äºº</li>
                        <li>æ”¯æŒç§æœ‰åŒ–éƒ¨ç½²</li>
                        <li>APIå¼€æ”¾ï¼Œæ˜“äºäºŒæ¬¡å¼€å‘</li>
                        <li>æ”¯æŒå¤šæ•°æ®æºæ¥å…¥</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <script>
        let apiEndpoint = 'http://localhost:8080';
        let apiToken = '';
        let currentKnowledgeBase = '';
        let selectedFiles = [];

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        window.onload = function() {
            // ä»localStorageæ¢å¤é…ç½®
            const savedEndpoint = localStorage.getItem('ragflow_endpoint');
            const savedToken = localStorage.getItem('ragflow_token');
            const savedKB = localStorage.getItem('ragflow_kb');

            if (savedEndpoint) {
                document.getElementById('apiEndpoint').value = savedEndpoint;
                apiEndpoint = savedEndpoint;
            }
            if (savedToken) {
                document.getElementById('apiToken').value = savedToken;
                apiToken = savedToken;
                testConnection();
            }
            if (savedKB) {
                currentKnowledgeBase = savedKB;
            }

            // è®¾ç½®æ–‡ä»¶ä¸Šä¼ äº‹ä»¶
            setupFileUpload();

            // è®¾ç½®Enterå‘é€
            document.getElementById('chatInput').addEventListener('keydown', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage();
                }
            });
        };

        // æµ‹è¯•è¿æ¥
        async function testConnection() {
            apiEndpoint = document.getElementById('apiEndpoint').value;
            apiToken = document.getElementById('apiToken').value;

            if (!apiToken) {
                showAlert('è¯·è¾“å…¥API Token', 'error');
                return;
            }

            showAlert('æ­£åœ¨è¿æ¥RAGFlow...', 'info');

            try {
                // è¿™é‡Œåº”è¯¥è°ƒç”¨RAGFlowçš„APIè¿›è¡ŒéªŒè¯
                // ç”±äºæ˜¯æ¼”ç¤ºï¼Œæˆ‘ä»¬æ¨¡æ‹Ÿä¸€ä¸ªæˆåŠŸçš„è¿æ¥
                setTimeout(() => {
                    updateConnectionStatus(true);
                    localStorage.setItem('ragflow_endpoint', apiEndpoint);
                    localStorage.setItem('ragflow_token', apiToken);
                    loadKnowledgeBases();
                    showAlert('è¿æ¥æˆåŠŸï¼', 'success');
                }, 1000);
            } catch (error) {
                updateConnectionStatus(false);
                showAlert('è¿æ¥å¤±è´¥ï¼š' + error.message, 'error');
            }
        }

        // æ›´æ–°è¿æ¥çŠ¶æ€
        function updateConnectionStatus(connected) {
            const statusDot = document.getElementById('statusDot');
            const statusText = document.getElementById('statusText');

            if (connected) {
                statusDot.classList.add('connected');
                statusText.textContent = 'å·²è¿æ¥';
            } else {
                statusDot.classList.remove('connected');
                statusText.textContent = 'æœªè¿æ¥';
            }
        }

        // åŠ è½½çŸ¥è¯†åº“åˆ—è¡¨
        function loadKnowledgeBases() {
            const select = document.getElementById('knowledgeBaseSelect');

            // æ¨¡æ‹ŸçŸ¥è¯†åº“åˆ—è¡¨
            const kbs = [
                { id: 'kb_001', name: 'å‘˜å·¥æ‰‹å†Œ' },
                { id: 'kb_002', name: 'åˆ¶åº¦æµç¨‹' },
                { id: 'kb_003', name: 'å…¥èŒåŸ¹è®­ææ–™' }
            ];

            select.innerHTML = '<option value="">-- è¯·é€‰æ‹©çŸ¥è¯†åº“ --</option>';
            kbs.forEach(kb => {
                const option = document.createElement('option');
                option.value = kb.id;
                option.textContent = kb.name;
                select.appendChild(option);
            });

            select.addEventListener('change', function() {
                currentKnowledgeBase = this.value;
                localStorage.setItem('ragflow_kb', this.value);
                if (this.value) {
                    showAlert('å·²åˆ‡æ¢åˆ°çŸ¥è¯†åº“ï¼š' + this.options[this.selectedIndex].text, 'success');
                }
            });

            // æ¢å¤ä¹‹å‰é€‰æ‹©çš„çŸ¥è¯†åº“
            if (currentKnowledgeBase) {
                select.value = currentKnowledgeBase;
            }
        }

        // æ–‡ä»¶ä¸Šä¼ ç›¸å…³
        function setupFileUpload() {
            const uploadArea = document.getElementById('fileUploadArea');
            const fileInput = document.getElementById('fileInput');

            uploadArea.addEventListener('click', () => fileInput.click());

            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.classList.add('dragging');
            });

            uploadArea.addEventListener('dragleave', () => {
                uploadArea.classList.remove('dragging');
            });

            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.classList.remove('dragging');
                handleFiles(e.dataTransfer.files);
            });

            fileInput.addEventListener('change', (e) => {
                handleFiles(e.target.files);
            });
        }

        function handleFiles(files) {
            for (let file of files) {
                if (!selectedFiles.find(f => f.name === file.name)) {
                    selectedFiles.push(file);
                }
            }
            updateFileList();
            document.getElementById('uploadBtn').disabled = selectedFiles.length === 0;
        }

        function updateFileList() {
            const fileList = document.getElementById('fileList');
            fileList.innerHTML = '';

            selectedFiles.forEach((file, index) => {
                const item = document.createElement('div');
                item.className = 'file-item';
                item.innerHTML = `
                    <span class="file-item-name" title="${file.name}">ğŸ“„ ${file.name}</span>
                    <span class="file-item-size">${formatFileSize(file.size)}</span>
                    <span class="remove-file-btn" onclick="removeFile(${index})">âœ•</span>
                `;
                fileList.appendChild(item);
            });
        }

        function removeFile(index) {
            selectedFiles.splice(index, 1);
            updateFileList();
            document.getElementById('uploadBtn').disabled = selectedFiles.length === 0;
        }

        function formatFileSize(bytes) {
            if (bytes < 1024) return bytes + ' B';
            if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';
            return (bytes / (1024 * 1024)).toFixed(1) + ' MB';
        }

        async function uploadFiles() {
            if (!currentKnowledgeBase) {
                showAlert('è¯·å…ˆé€‰æ‹©çŸ¥è¯†åº“', 'error');
                return;
            }

            if (selectedFiles.length === 0) {
                showAlert('è¯·å…ˆé€‰æ‹©æ–‡ä»¶', 'error');
                return;
            }

            const btn = document.getElementById('uploadBtn');
            btn.disabled = true;
            btn.innerHTML = '<div class="loading"></div> ä¸Šä¼ ä¸­...';

            // æ¨¡æ‹Ÿæ–‡ä»¶ä¸Šä¼ 
            setTimeout(() => {
                showAlert(`æˆåŠŸä¸Šä¼  ${selectedFiles.length} ä¸ªæ–‡ä»¶`, 'success');
                selectedFiles = [];
                updateFileList();
                btn.disabled = false;
                btn.innerHTML = 'â¬†ï¸ ä¸Šä¼ æ–‡æ¡£';
            }, 2000);
        }

        // èŠå¤©ç›¸å…³
        function askQuestion(question) {
            document.getElementById('chatInput').value = question;
            sendMessage();
        }

        async function sendMessage() {
            const input = document.getElementById('chatInput');
            const question = input.value.trim();

            if (!question) return;

            if (!currentKnowledgeBase) {
                showAlert('è¯·å…ˆé€‰æ‹©çŸ¥è¯†åº“', 'error');
                return;
            }

            input.value = '';
            addMessage('user', question);

            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            const loadingId = addMessage('assistant', '<div class="loading"></div> æ­£åœ¨æ€è€ƒ...');

            // æ¨¡æ‹ŸAIå›ç­”
            setTimeout(() => {
                removeMessage(loadingId);

                const answer = generateMockAnswer(question);
                addMessage('assistant', answer.text, answer.sources);
            }, 2000);
        }

        function addMessage(role, content, sources = null) {
            const messagesContainer = document.getElementById('chatMessages');

            // ç§»é™¤ç©ºçŠ¶æ€
            const emptyState = messagesContainer.querySelector('.empty-state');
            if (emptyState) {
                emptyState.remove();
            }

            const messageId = 'msg_' + Date.now();
            const message = document.createElement('div');
            message.className = `message ${role}`;
            message.id = messageId;

            let sourcesHtml = '';
            if (sources && sources.length > 0) {
                sourcesHtml = `
                    <div class="message-sources">
                        <h4>ğŸ“š å‚è€ƒæ¥æº</h4>
                        ${sources.map(s => `
                            <div class="source-item">
                                <span>ğŸ“„</span>
                                <span>${s.file}</span>
                                <span style="color: #6c757d;">P${s.page}</span>
                            </div>
                        `).join('')}
                    </div>
                `;
            }

            message.innerHTML = `
                <div class="message-avatar">${role === 'user' ? 'ğŸ‘¤' : 'ğŸ¤–'}</div>
                <div class="message-content">
                    ${content}
                    ${sourcesHtml}
                </div>
            `;

            messagesContainer.appendChild(message);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;

            return messageId;
        }

        function removeMessage(messageId) {
            const message = document.getElementById(messageId);
            if (message) {
                message.remove();
            }
        }

        function generateMockAnswer(question) {
            const answers = {
                'è€ƒå‹¤': {
                    text: 'æ ¹æ®ã€Šå‘˜å·¥æ‰‹å†Œã€‹ç¬¬3ç« è§„å®šï¼š\n\n1. å·¥ä½œæ—¶é—´ï¼šå‘¨ä¸€è‡³å‘¨äº” 9:00-18:00ï¼Œåˆä¼‘12:00-13:00\n2. è€ƒå‹¤æ–¹å¼ï¼šéœ€åœ¨å…¬å¸å‰å°æ‰“å¡æœºæ‰“å¡ï¼Œæˆ–é€šè¿‡é’‰é’‰/ä¼ä¸šå¾®ä¿¡ç­¾åˆ°\n3. è¿Ÿåˆ°å¤„ç†ï¼šè¿Ÿåˆ°15åˆ†é’Ÿå†…ç®—è¿Ÿåˆ°ï¼Œè¶…è¿‡15åˆ†é’ŸæŒ‰æ—·å·¥åŠå¤©å¤„ç†\n4. è¯·å‡æµç¨‹ï¼šæå‰1å¤©åœ¨ç³»ç»Ÿæäº¤ç”³è¯·ï¼Œç»ç›´å±ä¸»ç®¡å®¡æ‰¹\n\næ›´å¤šè¯¦ç»†è§„å®šè¯·å‚è€ƒå³ä¾§æ–‡æ¡£æ¥æºã€‚',
                    sources: [
                        { file: 'å‘˜å·¥æ‰‹å†Œ2024ç‰ˆ.pdf', page: 23 },
                        { file: 'è€ƒå‹¤ç®¡ç†åˆ¶åº¦.docx', page: 1 }
                    ]
                },
                'å¹´å‡': {
                    text: 'å¹´å‡ç”³è¯·æµç¨‹å¦‚ä¸‹ï¼š\n\n1. ç™»å½•HRç³»ç»Ÿï¼ˆhr.company.comï¼‰\n2. ç‚¹å‡»"å‡æœŸç®¡ç†" â†’ "å¹´å‡ç”³è¯·"\n3. å¡«å†™è¯·å‡æ—¶é—´ã€äº‹ç”±\n4. æäº¤åç­‰å¾…å®¡æ‰¹ï¼ˆä¸€èˆ¬1ä¸ªå·¥ä½œæ—¥å†…ï¼‰\n5. å®¡æ‰¹é€šè¿‡åç³»ç»Ÿè‡ªåŠ¨æ‰£é™¤å¹´å‡å¤©æ•°\n\næ³¨æ„ï¼šå¹´å‡éœ€è¦æå‰3å¤©ç”³è¯·ï¼ŒèŠ‚å‡æ—¥å‰åéœ€æå‰7å¤©ç”³è¯·ã€‚',
                    sources: [
                        { file: 'å‡æœŸç®¡ç†è§„å®š.pdf', page: 5 },
                        { file: 'HRç³»ç»Ÿä½¿ç”¨æŒ‡å—.docx', page: 12 }
                    ]
                },
                'ç¦åˆ©': {
                    text: 'å…¬å¸æä¾›ä»¥ä¸‹å‘˜å·¥ç¦åˆ©ï¼š\n\nğŸ“‹ æ³•å®šç¦åˆ©ï¼š\n- äº”é™©ä¸€é‡‘ï¼ˆå…¥èŒå³ç¼´çº³ï¼‰\n- å¸¦è–ªå¹´å‡ï¼ˆå·¥ä½œæ»¡1å¹´5å¤©èµ·ï¼‰\n\nğŸ é¢å¤–ç¦åˆ©ï¼š\n- å•†ä¸šä¿é™©ï¼ˆå…¥èŒæ»¡3ä¸ªæœˆï¼‰\n- å¹´åº¦ä½“æ£€\n- èŠ‚æ—¥ç¦åˆ©ï¼ˆæ˜¥èŠ‚ã€ä¸­ç§‹ç­‰ï¼‰\n- ç”Ÿæ—¥ç¤¼é‡‘\n- å›¢å»ºæ´»åŠ¨ï¼ˆæ¯å­£åº¦ä¸€æ¬¡ï¼‰\n- ä¸‹åˆèŒ¶ï¼ˆæ¯å‘¨ä¸‰ï¼‰\n\nè¯¦ç»†è¯´æ˜è¯·å‚è€ƒã€Šå‘˜å·¥ç¦åˆ©æ‰‹å†Œã€‹ã€‚',
                    sources: [
                        { file: 'å‘˜å·¥ç¦åˆ©æ‰‹å†Œ2024.pdf', page: 1 },
                        { file: 'è–ªé…¬ç¦åˆ©åˆ¶åº¦.docx', page: 8 }
                    ]
                },
                'æŠ¥é”€': {
                    text: 'æŠ¥é”€æµç¨‹ï¼š\n\n1. å‡†å¤‡ææ–™ï¼š\n   - åŸå§‹å‘ç¥¨ï¼ˆéœ€åŠ ç›–å…¬ç« ï¼‰\n   - è´¹ç”¨æ˜ç»†æ¸…å•\n   - æŠ¥é”€ç”³è¯·è¡¨\n\n2. æäº¤æµç¨‹ï¼š\n   - ç™»å½•è´¢åŠ¡ç³»ç»Ÿ\n   - å¡«å†™æŠ¥é”€å•æ®\n   - ä¸Šä¼ å‘ç¥¨ç…§ç‰‡\n   - æäº¤å®¡æ‰¹\n\n3. å®¡æ‰¹æµç¨‹ï¼š\n   - 500å…ƒä»¥ä¸‹ï¼šç›´å±ä¸»ç®¡\n   - 500-5000å…ƒï¼šéƒ¨é—¨æ€»ç›‘\n   - 5000å…ƒä»¥ä¸Šï¼šè´¢åŠ¡æ€»ç›‘+CEO\n\n4. åˆ°è´¦æ—¶é—´ï¼šå®¡æ‰¹é€šè¿‡å3-5ä¸ªå·¥ä½œæ—¥\n\næ³¨æ„ï¼šå‘ç¥¨éœ€åœ¨è´¹ç”¨å‘ç”Ÿå3ä¸ªæœˆå†…æäº¤ã€‚',
                    sources: [
                        { file: 'è´¢åŠ¡ç®¡ç†åˆ¶åº¦.pdf', page: 15 },
                        { file: 'æŠ¥é”€æ“ä½œæŒ‡å—.pdf', page: 2 }
                    ]
                }
            };

            for (let keyword in answers) {
                if (question.includes(keyword)) {
                    return answers[keyword];
                }
            }

            return {
                text: 'æŠ±æ­‰ï¼Œæˆ‘åœ¨çŸ¥è¯†åº“ä¸­æ²¡æœ‰æ‰¾åˆ°ä¸æ‚¨é—®é¢˜ç›¸å…³çš„ä¿¡æ¯ã€‚æ‚¨å¯ä»¥ï¼š\n\n1. å°è¯•æ¢ä¸ªæ–¹å¼æé—®\n2. ä¸Šä¼ ç›¸å…³æ–‡æ¡£åˆ°çŸ¥è¯†åº“\n3. è”ç³»HRåŒäº‹è·å–å¸®åŠ©\n\nå¦‚æœæ˜¯æ–°å‘˜å·¥å¸¸è§é—®é¢˜ï¼Œå»ºè®®ç‚¹å‡»ä¸Šæ–¹çš„å¿«æ·é—®é¢˜æŒ‰é’®ã€‚',
                sources: []
            };
        }

        function showAlert(message, type) {
            const container = document.getElementById('alertContainer');
            const alert = document.createElement('div');
            alert.className = `alert alert-${type}`;
            alert.textContent = message;

            container.innerHTML = '';
            container.appendChild(alert);

            setTimeout(() => {
                alert.remove();
            }, 5000);
        }
    </script>
</body>
</html>